<UserControl
    x:Class="YouTubeHelper.Views.MainControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:busyIndicator="https://github.com/Peoky/BusyIndicator"
    xmlns:c="clr-namespace:CalcBinding;assembly=CalcBinding"
    xmlns:controls="clr-namespace:Notification.Wpf.Controls;assembly=Notification.Wpf"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:properties="clr-namespace:YouTubeHelper.Properties"
    xmlns:ui="http://schemas.modernwpf.com/2019"
    xmlns:utilities="clr-namespace:YouTubeHelper.Utilities"
    xmlns:viewModels="clr-namespace:YouTubeHelper.ViewModels"
    xmlns:views="clr-namespace:YouTubeHelper.Views"
    d:DataContext="{d:DesignInstance Type=viewModels:MainControlViewModel,
                                     IsDesignTimeCreatable=True}"
    Loaded="UserControl_Loaded"
    mc:Ignorable="d">
    <Grid>
        <busyIndicator:BusyMask
            x:Name="BusyIndicator"
            BusyContent="{x:Static properties:Resources.Searching}"
            IndicatorType="ThreeDots"
            IsBusy="{Binding IsBusy}">
            <Grid>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="20" />
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="1" Background="{DynamicResource SystemControlBackgroundListLowBrush}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="20" />
                        </Grid.ColumnDefinitions>

                        <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                            <Label Margin="0,0,5,0" Content="{Binding CurrentDownloadDirectoryLabel}" />
                            <Label Margin="5,0,5,0" Content="•" />
                            <Label Margin="5,0,5,0" Content="{Binding ActiveDownloadsCountLabel}" />
                            <Label Margin="5,0,5,0" Content="•" />
                            <Label Margin="5,0,0,0" Content="{Binding SelectedChannel.CountLabel}" />
                        </StackPanel>
                    </Grid>

                    <Grid Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="{c:Binding 'IsMainControlExpanded ? TwoStarGridLength : FifteenPixelGridLength'}" />
                            <ColumnDefinition Width="{c:Binding '!IsMainControlExpanded and !IsPlayerExpanded ? OneStarGridLength : ZeroGridLength'}" />
                            <ColumnDefinition Width="{c:Binding 'IsPlayerExpanded ? OneStarGridLength : FifteenPixelGridLength'}" />
                        </Grid.ColumnDefinitions>

                        <Expander
                            x:Name="Expander"
                            Grid.Column="2"
                            Padding="0,10,0,0"
                            Background="{DynamicResource SystemControlBackgroundListLowBrush}"
                            ExpandDirection="Left"
                            IsExpanded="{Binding IsPlayerExpanded}">
                            <Grid Margin="15,0,0,0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>

                                <Label
                                    Grid.Row="1"
                                    HorizontalAlignment="Center"
                                    Content="{Binding ActiveVideoTitle}"
                                    FontWeight="Bold" />
                                <MediaElement
                                    x:Name="MediaElement"
                                    Grid.Row="2"
                                    MaxWidth="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=FrameworkElement}}"
                                    MaxHeight="{c:Binding 'ActualHeight - 75',
                                                          RelativeSource={RelativeSource AncestorType=FrameworkElement}}"
                                    LoadedBehavior="Manual"
                                    PreviewMouseDown="MediaElement_PreviewMouseDown"
                                    Source="{Binding ActiveVideo}" />
                                <Label
                                    Grid.Row="3"
                                    Width="{Binding ActualWidth, ElementName=MediaElement}"
                                    Padding="0,5,1,0"
                                    HorizontalContentAlignment="Right"
                                    Content="{Binding ActiveVideoTimeString}" />
                                <Slider
                                    x:Name="MediaScrub"
                                    Grid.Row="4"
                                    Width="{Binding ActualWidth, ElementName=MediaElement}"
                                    IsMoveToPointEnabled="True"
                                    Maximum="1"
                                    Minimum="0" />
                            </Grid>
                        </Expander>

                        <Expander
                            Grid.Column="0"
                            Padding="0,10,0,0"
                            Background="{DynamicResource SystemControlBackgroundListLowBrush}"
                            ExpandDirection="Right"
                            IsExpanded="{Binding IsMainControlExpanded}">
                            <TabControl
                                Margin="0,-15,0,0"
                                Background="#e6e6e6"
                                ItemsSource="{Binding Channels}"
                                SelectedItem="{Binding SelectedChannel}">
                                <TabControl.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Channel.VanityName}" ToolTip="{Binding Channel.ExtendedDescription}" />
                                    </DataTemplate>
                                </TabControl.ItemTemplate>
                                <TabControl.ContentTemplate>
                                    <DataTemplate>
                                        <Grid Background="White">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto" />
                                                <RowDefinition Height="Auto" />
                                                <RowDefinition Height="*" />
                                            </Grid.RowDefinitions>

                                            <Grid Margin="15,10,30,10" Visibility="{c:Binding 'QueueMode', FalseToVisibility=Collapsed}" />

                                            <Expander
                                                Grid.Row="0"
                                                Margin="15,15,30,15"
                                                Visibility="{c:Binding '!QueueMode',
                                                                       FalseToVisibility=Collapsed}">
                                                <Expander.Header>
                                                    <!--  Need to use this width hack in order for the header content to stretch horizontally  -->
                                                    <!--  https://stackoverflow.com/a/680512/4206279  -->
                                                    <Grid Width="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Expander}}, Path=ActualWidth}">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto" />
                                                            <ColumnDefinition Width="*" />
                                                        </Grid.ColumnDefinitions>

                                                        <TextBlock Grid.Column="0" Text="Channel Settings" />
                                                        <Border
                                                            Grid.Column="1"
                                                            Margin="10,8,22,5"
                                                            HorizontalAlignment="Stretch"
                                                            Background="{DynamicResource SystemControlBackgroundListLowBrush}"
                                                            CornerRadius="2" />
                                                    </Grid>
                                                </Expander.Header>

                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width=".25*" />
                                                        <ColumnDefinition Width="50" />
                                                    </Grid.ColumnDefinitions>

                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="5" />
                                                        <RowDefinition Height="Auto" />
                                                        <RowDefinition Height="5" />
                                                        <RowDefinition Height="Auto" />
                                                    </Grid.RowDefinitions>

                                                    <TextBox
                                                        Grid.Row="1"
                                                        Grid.Column="0"
                                                        HorizontalAlignment="Stretch"
                                                        VerticalAlignment="Center"
                                                        Text="{Binding Channel.Identifier, UpdateSourceTrigger=PropertyChanged, Delay=10}" />
                                                    <TextBox
                                                        Grid.Row="1"
                                                        Grid.Column="1"
                                                        Margin="10,0,0,0"
                                                        HorizontalAlignment="Stretch"
                                                        VerticalAlignment="Center"
                                                        IsReadOnly="true"
                                                        Text="{Binding Channel.ChannelPlaylist}" />
                                                    <Button
                                                        Grid.Row="1"
                                                        Grid.Column="2"
                                                        HorizontalAlignment="Right"
                                                        Command="{Binding LookupChannelCommand}">
                                                        <ui:FontIcon Glyph="{Binding SearchGlyph}" />
                                                    </Button>
                                                    <Button
                                                        Grid.Row="3"
                                                        Grid.Column="0"
                                                        Grid.ColumnSpan="3"
                                                        HorizontalAlignment="Stretch"
                                                        Command="{Binding DeleteCommand}"
                                                        Content="Delete" />
                                                </Grid>
                                            </Expander>

                                            <ScrollViewer Grid.Row="1" HorizontalScrollBarVisibility="Auto">
                                                <Grid Margin="0,0,30,15">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto" />
                                                        <ColumnDefinition Width="10" />
                                                        <ColumnDefinition Width="Auto" />
                                                        <ColumnDefinition Width="10" />
                                                        <ColumnDefinition Width="Auto" />
                                                        <ColumnDefinition Width="10" />
                                                        <ColumnDefinition Width="Auto" />
                                                        <ColumnDefinition Width="10" />
                                                        <ColumnDefinition Width="Auto" />
                                                        <ColumnDefinition Width="10" />
                                                        <ColumnDefinition Width="Auto" />
                                                        <ColumnDefinition Width="10" />
                                                        <ColumnDefinition Width="Auto" />
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="Auto" />
                                                        <ColumnDefinition Width="5" />
                                                        <ColumnDefinition Width="Auto" />
                                                    </Grid.ColumnDefinitions>

                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="33" />
                                                    </Grid.RowDefinitions>

                                                    <Button
                                                        Grid.Column="0"
                                                        Margin="15,0,0,0"
                                                        VerticalAlignment="Stretch"
                                                        Command="{Binding FindVideosCommand}"
                                                        Visibility="{c:Binding '!ExclusionsMode and !QueueMode',
                                                                               FalseToVisibility=Collapsed}">
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="Auto" />
                                                                <ColumnDefinition Width="5" />
                                                                <ColumnDefinition Width="Auto" />
                                                            </Grid.ColumnDefinitions>

                                                            <ui:FontIcon Grid.Column="0" Glyph="&#xEBE7;" />
                                                            <TextBlock Grid.Column="2" Text="{x:Static properties:Resources.Search}" />
                                                        </Grid>
                                                    </Button>

                                                    <Button
                                                        Grid.Column="0"
                                                        Margin="15,0,0,0"
                                                        VerticalAlignment="Stretch"
                                                        Command="{Binding FindExclusionsCommand}"
                                                        Visibility="{c:Binding 'ExclusionsMode and !QueueMode',
                                                                               FalseToVisibility=Collapsed}">
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="Auto" />
                                                                <ColumnDefinition Width="5" />
                                                                <ColumnDefinition Width="Auto" />
                                                            </Grid.ColumnDefinitions>

                                                            <ui:FontIcon Grid.Column="0" Glyph="&#xEBE7;" />
                                                            <TextBlock Grid.Column="2" Text="{x:Static properties:Resources.View}" />
                                                        </Grid>
                                                    </Button>

                                                    <Button
                                                        Grid.Column="0"
                                                        Margin="15,0,0,0"
                                                        VerticalAlignment="Stretch"
                                                        Command="{Binding LoadQueueCommand}"
                                                        Visibility="{c:Binding 'QueueMode',
                                                                               FalseToVisibility=Collapsed}">
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="Auto" />
                                                                <ColumnDefinition Width="5" />
                                                                <ColumnDefinition Width="Auto" />
                                                            </Grid.ColumnDefinitions>

                                                            <ui:FontIcon Grid.Column="0" Glyph="&#xEBE7;" />
                                                            <TextBlock Grid.Column="2" Text="{x:Static properties:Resources.Load}" />
                                                        </Grid>
                                                    </Button>

                                                    <ComboBox
                                                        Grid.Column="2"
                                                        VerticalAlignment="Stretch"
                                                        DisplayMemberPath="Description"
                                                        ItemsSource="{Binding MainControlViewModel.SortModeValues}"
                                                        SelectedIndex="{Binding MainControlViewModel.SelectedSortModeIndex}"
                                                        SelectedItem="{Binding MainControlViewModel.SelectedSortMode}"
                                                        Visibility="{c:Binding '!QueueMode',
                                                                               FalseToVisibility=Collapsed}" />

                                                    <CheckBox
                                                        Grid.Column="4"
                                                        Content="{x:Static properties:Resources.ShowExcludedVideos}"
                                                        IsChecked="{Binding MainControlViewModel.ShowExcludedVideos}"
                                                        Visibility="{c:Binding '!ExclusionsMode and !QueueMode',
                                                                               FalseToVisibility=Collapsed}" />

                                                    <ComboBox
                                                        Grid.Column="4"
                                                        DisplayMemberPath="Description"
                                                        ItemsSource="{Binding MainControlViewModel.ExclusionReasonValues}"
                                                        SelectedIndex="{Binding MainControlViewModel.SelectedExclusionFilterIndex}"
                                                        SelectedItem="{Binding MainControlViewModel.SelectedExclusionFilter}"
                                                        Visibility="{c:Binding ExclusionsMode,
                                                                               FalseToVisibility=Collapsed}" />

                                                    <CheckBox
                                                        Grid.Column="6"
                                                        Content="{x:Static properties:Resources.DoNotShowVideosBefore}"
                                                        IsChecked="{Binding MainControlViewModel.SelectedChannel.Channel.EnableDateRangeLimit}"
                                                        Visibility="{c:Binding WatchMode,
                                                                               FalseToVisibility=Collapsed}" />

                                                    <TextBox
                                                        Grid.Column="6"
                                                        MinWidth="250"
                                                        Padding="10,5,10,5"
                                                        VerticalAlignment="Stretch"
                                                        VerticalContentAlignment="Center"
                                                        ui:ControlHelper.PlaceholderText="{x:Static properties:Resources.ExactSearch}"
                                                        KeyDown="Search_KeyDown"
                                                        Text="{Binding MainControlViewModel.ExactSearchTerm, UpdateSourceTrigger=PropertyChanged}"
                                                        Visibility="{c:Binding 'SearchMode',
                                                                               FalseToVisibility=Collapsed}" />

                                                    <DatePicker
                                                        Grid.Column="8"
                                                        ui:ControlHelper.PlaceholderText="{x:Static properties:Resources.DateRangeLimit}"
                                                        IsEnabled="{Binding MainControlViewModel.SelectedChannel.Channel.EnableDateRangeLimit}"
                                                        SelectedDate="{Binding MainControlViewModel.SelectedChannel.Channel.DateRangeLimit}"
                                                        Visibility="{c:Binding WatchMode,
                                                                               FalseToVisibility=Collapsed}" />

                                                    <TextBox
                                                        Grid.Column="8"
                                                        MinWidth="400"
                                                        Padding="10,5,10,5"
                                                        VerticalAlignment="Stretch"
                                                        VerticalContentAlignment="Center"
                                                        ui:ControlHelper.PlaceholderText="{x:Static properties:Resources.Lookup}"
                                                        KeyDown="Search_KeyDown"
                                                        Text="{Binding MainControlViewModel.LookupSearchTerm, UpdateSourceTrigger=PropertyChanged}"
                                                        Visibility="{c:Binding 'SearchMode',
                                                                               FalseToVisibility=Collapsed}" />

                                                    <CheckBox
                                                        Grid.Column="10"
                                                        Content="{x:Static properties:Resources.DoNotShowVideosShorterThan}"
                                                        IsChecked="{Binding MainControlViewModel.SelectedChannel.Channel.EnableVideoLengthMinimum}"
                                                        Visibility="{c:Binding WatchMode,
                                                                               FalseToVisibility=Collapsed}" />

                                                    <ui:NumberBox
                                                        Grid.Column="12"
                                                        ui:ControlHelper.PlaceholderText="{x:Static properties:Resources.VideoLengthMinimum}"
                                                        IsEnabled="{Binding MainControlViewModel.SelectedChannel.Channel.EnableVideoLengthMinimum}"
                                                        Visibility="{c:Binding WatchMode,
                                                                               FalseToVisibility=Collapsed}"
                                                        Value="{Binding MainControlViewModel.SelectedChannel.Channel.VideoLengthMinimumInSeconds}" />

                                                    <Button
                                                        Grid.Column="14"
                                                        Margin="15,0,0,0"
                                                        VerticalAlignment="Stretch"
                                                        Command="{Binding MoveLeftCommand}"
                                                        Visibility="{c:Binding '!QueueMode',
                                                                               FalseToVisibility=Collapsed}">
                                                        <ui:FontIcon Glyph="&#xE760;" />
                                                    </Button>
                                                    <Button
                                                        Grid.Column="16"
                                                        Margin="0,0,0,0"
                                                        VerticalAlignment="Stretch"
                                                        Command="{Binding MoveRightCommand}"
                                                        Visibility="{c:Binding '!QueueMode',
                                                                               FalseToVisibility=Collapsed}">
                                                        <ui:FontIcon Glyph="&#xE761;" />
                                                    </Button>
                                                </Grid>
                                            </ScrollViewer>

                                            <ItemsControl
                                                Grid.Row="2"
                                                ItemsSource="{Binding Videos}"
                                                VirtualizingPanel.ScrollUnit="Pixel">
                                                <!--
                                                    The ItemsPanel and Template come from https://stackoverflow.com/a/2784220/4206279
                                                    Using a VirtualizingStackPanel causes by-item scrolling, hence the need for ScrollUnit="Pixel" property.
                                                    Together, these changes allow fairly smooth scrolling with MUCH faster load times due to virtualization
                                                -->

                                                <!--  The Panel control that holds the items should support virtualization  -->
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate>
                                                        <VirtualizingStackPanel IsVirtualizing="True" VirtualizationMode="Recycling" />
                                                    </ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>

                                                <!--  The template should be a ScrollViewer  -->
                                                <ItemsControl.Template>
                                                    <ControlTemplate TargetType="ItemsControl">
                                                        <Border
                                                            Background="{TemplateBinding Background}"
                                                            BorderBrush="{TemplateBinding BorderBrush}"
                                                            BorderThickness="{TemplateBinding BorderThickness}">
                                                            <views:MyScrollViewer
                                                                Padding="{TemplateBinding Padding}"
                                                                ui:ScrollViewerHelper.AutoHideScrollBars="False"
                                                                CanContentScroll="True"
                                                                Focusable="False">
                                                                <ItemsPresenter />
                                                            </views:MyScrollViewer>
                                                        </Border>
                                                    </ControlTemplate>
                                                </ItemsControl.Template>

                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Grid Margin="15,0,30,0">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="Auto" />
                                                                <ColumnDefinition Width="*" />
                                                                <ColumnDefinition Width="Auto" />
                                                            </Grid.ColumnDefinitions>

                                                            <Grid.RowDefinitions>
                                                                <RowDefinition Height="Auto" />
                                                                <RowDefinition Height="Auto" />
                                                            </Grid.RowDefinitions>

                                                            <Image
                                                                Grid.Column="0"
                                                                Width="150"
                                                                Margin="0,0,10,10"
                                                                HorizontalAlignment="Left"
                                                                VerticalAlignment="Top"
                                                                Source="{Binding Video.ThumbnailUrl}">
                                                                <Image.Clip>
                                                                    <RectangleGeometry
                                                                        RadiusX="8"
                                                                        RadiusY="8"
                                                                        Rect="0,0,150,85" />
                                                                </Image.Clip>
                                                            </Image>

                                                            <Grid
                                                                Grid.Row="0"
                                                                Grid.Column="1"
                                                                Margin="0,0,15,0">
                                                                <Grid.RowDefinitions>
                                                                    <RowDefinition Height="Auto" />
                                                                    <RowDefinition Height="Auto" />
                                                                    <RowDefinition Height="Auto" />
                                                                    <RowDefinition Height="*" />
                                                                    <RowDefinition Height="Auto" />
                                                                </Grid.RowDefinitions>

                                                                <StackPanel Grid.Row="0" Orientation="Horizontal">
                                                                    <TextBlock
                                                                        FontWeight="Medium"
                                                                        Text="{Binding Video.Title}"
                                                                        TextWrapping="Wrap" />
                                                                    <TextBlock
                                                                        Padding="15,0,15,0"
                                                                        Cursor="Hand"
                                                                        FontWeight="Light"
                                                                        MouseDown="TextBlock_MouseDown"
                                                                        Text="{Binding Video.Id}"
                                                                        TextWrapping="Wrap" />
                                                                </StackPanel>
                                                                <TextBlock
                                                                    Grid.Row="1"
                                                                    Text="{Binding Video.TimeString}"
                                                                    TextWrapping="Wrap" />

                                                                <StackPanel Grid.Row="2" Orientation="Horizontal">
                                                                    <TextBlock
                                                                        Padding="0,0,15,0"
                                                                        FontWeight="Medium"
                                                                        Foreground="Red"
                                                                        Text="{Binding ExcludedString}"
                                                                        TextWrapping="Wrap"
                                                                        Visibility="{c:Binding Video.Excluded,
                                                                                               FalseToVisibility=Collapsed}" />
                                                                    <TextBlock
                                                                        Padding="0,0,15,0"
                                                                        FontWeight="Medium"
                                                                        Foreground="Green"
                                                                        Text="{Binding Video.Status}"
                                                                        TextWrapping="Wrap"
                                                                        Visibility="{c:Binding 'Video.Status != null and !Video.Excluded',
                                                                                               FalseToVisibility=Collapsed}" />
                                                                    <TextBlock
                                                                        FontWeight="Medium"
                                                                        Foreground="Black"
                                                                        Text="{x:Static properties:Resources.Playing}"
                                                                        TextWrapping="Wrap"
                                                                        Visibility="{c:Binding Video.IsPlaying,
                                                                                               FalseToVisibility=Collapsed}" />
                                                                </StackPanel>

                                                                <Expander
                                                                    Grid.Row="3"
                                                                    Header="Description"
                                                                    IsExpanded="{Binding IsDescriptionExpanded}">
                                                                    <ScrollViewer MaxHeight="200" VerticalScrollBarVisibility="Auto">
                                                                        <TextBlock FontSize="13" Text="{Binding Video.Description}" />
                                                                    </ScrollViewer>
                                                                </Expander>
                                                            </Grid>

                                                            <Grid Grid.Column="2" VerticalAlignment="Top">
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition />
                                                                    <ColumnDefinition Width="5" />
                                                                    <ColumnDefinition />
                                                                </Grid.ColumnDefinitions>

                                                                <Grid.RowDefinitions>
                                                                    <RowDefinition Height="10" />
                                                                    <RowDefinition />
                                                                    <RowDefinition Height="5" />
                                                                    <RowDefinition />
                                                                    <RowDefinition Height="*" />
                                                                </Grid.RowDefinitions>

                                                                <Button
                                                                    Grid.Row="1"
                                                                    Grid.Column="0"
                                                                    Command="{Binding DownloadVideoCommand}"
                                                                    ToolTip="{x:Static properties:Resources.DownloadButtonToolTip}">
                                                                    <ui:FontIcon Glyph="&#xE896;" />
                                                                    <Button.InputBindings>
                                                                        <MouseBinding Command="{Binding DownloadVideoCommandRightClick}" Gesture="RightClick" />
                                                                    </Button.InputBindings>
                                                                </Button>

                                                                <Button
                                                                    Grid.Row="3"
                                                                    Grid.Column="0"
                                                                    Visibility="{c:Binding '!Video.Excluded',
                                                                                           FalseToVisibility=Collapsed}">
                                                                    <ui:FontIcon Glyph="&#xEA39;" />
                                                                    <ui:FlyoutService.Flyout>
                                                                        <ui:Flyout Opened="Flyout_Opened">
                                                                            <ui:Flyout.FlyoutPresenterStyle>
                                                                                <Style TargetType="ui:FlyoutPresenter">
                                                                                    <Setter Property="Padding" Value="0" />
                                                                                </Style>
                                                                            </ui:Flyout.FlyoutPresenterStyle>

                                                                            <Grid>
                                                                                <Grid.RowDefinitions>
                                                                                    <RowDefinition />
                                                                                    <RowDefinition />
                                                                                    <RowDefinition />
                                                                                </Grid.RowDefinitions>

                                                                                <Button
                                                                                    Grid.Row="0"
                                                                                    HorizontalAlignment="Stretch"
                                                                                    HorizontalContentAlignment="Left"
                                                                                    Background="Transparent"
                                                                                    Command="{Binding ExcludeVideoCommand}"
                                                                                    CommandParameter="{Binding RelativeSource={RelativeSource Self}}"
                                                                                    Content="{x:Static properties:Resources.Watched}" />
                                                                                <Button
                                                                                    Grid.Row="1"
                                                                                    HorizontalAlignment="Stretch"
                                                                                    HorizontalContentAlignment="Left"
                                                                                    Background="Transparent"
                                                                                    Command="{Binding ExcludeVideoCommand}"
                                                                                    CommandParameter="{Binding RelativeSource={RelativeSource Self}}"
                                                                                    Content="{x:Static properties:Resources.WontWatch}" />
                                                                                <Button
                                                                                    Grid.Row="2"
                                                                                    HorizontalAlignment="Stretch"
                                                                                    HorizontalContentAlignment="Left"
                                                                                    Background="Transparent"
                                                                                    Command="{Binding ExcludeVideoCommand}"
                                                                                    CommandParameter="{Binding RelativeSource={RelativeSource Self}}"
                                                                                    Content="{x:Static properties:Resources.MightWatch}" />
                                                                            </Grid>
                                                                        </ui:Flyout>
                                                                    </ui:FlyoutService.Flyout>
                                                                </Button>

                                                                <Button
                                                                    Grid.Row="3"
                                                                    Grid.Column="0"
                                                                    Command="{Binding UnexcludeVideoCommand}"
                                                                    Visibility="{c:Binding 'Video.Excluded',
                                                                                           FalseToVisibility=Collapsed}">
                                                                    <ui:FontIcon Glyph="&#xECC8;" />
                                                                </Button>

                                                                <Button
                                                                    Grid.Row="1"
                                                                    Grid.Column="2"
                                                                    Command="{Binding PlayVideoCommand}">
                                                                    <ui:FontIcon Glyph="&#xE768;" />
                                                                </Button>

                                                                <Button
                                                                    Grid.Row="3"
                                                                    Grid.Column="2"
                                                                    Command="{Binding PlayVideoInBrowserCommand}">
                                                                    <ui:FontIcon Glyph="&#xE774;" />
                                                                </Button>
                                                            </Grid>

                                                            <Border
                                                                Grid.Row="1"
                                                                Grid.Column="0"
                                                                Grid.ColumnSpan="3"
                                                                Height="6"
                                                                Margin="0,0,0,10"
                                                                HorizontalAlignment="Stretch"
                                                                Background="{DynamicResource SystemControlBackgroundListLowBrush}"
                                                                CornerRadius="2" />
                                                        </Grid>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </Grid>
                                    </DataTemplate>
                                </TabControl.ContentTemplate>
                            </TabControl>
                        </Expander>
                    </Grid>
                </Grid>
                <controls:NotificationArea
                    x:Name="NotificationArea"
                    MaxItems="3"
                    Position="BottomCenter" />
            </Grid>
        </busyIndicator:BusyMask>
    </Grid>
</UserControl>