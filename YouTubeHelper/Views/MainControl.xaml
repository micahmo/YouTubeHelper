<UserControl
    x:Class="YouTubeHelper.Views.MainControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:busyIndicator="https://github.com/Peoky/BusyIndicator"
    xmlns:c="clr-namespace:CalcBinding;assembly=CalcBinding"
    xmlns:controls="clr-namespace:Notification.Wpf.Controls;assembly=Notification.Wpf"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:properties="clr-namespace:YouTubeHelper.Properties"
    xmlns:ui="http://schemas.modernwpf.com/2019"
    xmlns:utilities="clr-namespace:YouTubeHelper.Utilities"
    xmlns:viewModels="clr-namespace:YouTubeHelper.ViewModels"
    xmlns:views="clr-namespace:YouTubeHelper.Views"
    d:DataContext="{d:DesignInstance Type=viewModels:MainControlViewModel,
                                     IsDesignTimeCreatable=True}"
    Loaded="UserControl_Loaded"
    mc:Ignorable="d">
    <Grid>
        <busyIndicator:BusyMask
            x:Name="BusyIndicator"
            BusyContent="{x:Static properties:Resources.Loading}"
            IndicatorType="ThreeDots"
            IsBusy="{Binding IsBusy}">
            <Grid>
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="20" />
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="1" Background="{DynamicResource SystemControlBackgroundListLowBrush}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="20" />
                        </Grid.ColumnDefinitions>

                        <Label
                            Grid.Column="0"
                            Margin="10,0,0,0"
                            Content="{Binding SelectedChannel.SearchOptionsSummary}" />

                        <StackPanel
                            Grid.Column="1"
                            HorizontalAlignment="Right"
                            Orientation="Horizontal">
                            <Label Margin="0,0,5,0" Content="{Binding CurrentDownloadDirectoryLabel}" />
                            <Label Margin="5,0,5,0" Content="•" />
                            <Label Margin="5,0,5,0" Content="{Binding ActiveDownloadsCountLabel}" />
                            <Label Margin="5,0,5,0" Content="•" />
                            <Label Margin="5,0,0,0" Content="{Binding SelectedChannel.CountLabel}" />
                        </StackPanel>
                    </Grid>

                    <Grid Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="{c:Binding 'IsMainControlExpanded ? TwoStarGridLength : FifteenPixelGridLength'}" />
                            <ColumnDefinition Width="{c:Binding '!IsMainControlExpanded and !IsPlayerExpanded ? OneStarGridLength : ZeroGridLength'}" />
                            <ColumnDefinition Width="{c:Binding 'IsPlayerExpanded ? OneStarGridLength : FifteenPixelGridLength'}" />
                        </Grid.ColumnDefinitions>

                        <Expander
                            x:Name="Expander"
                            Grid.Column="2"
                            Padding="0,10,0,0"
                            Background="{DynamicResource SystemControlBackgroundListLowBrush}"
                            ExpandDirection="Left"
                            IsExpanded="{Binding IsPlayerExpanded}">
                            <Grid Margin="15,0,0,0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>

                                <Label
                                    Grid.Row="1"
                                    HorizontalAlignment="Center"
                                    Content="{Binding ActiveVideoTitle}"
                                    FontWeight="Bold" />
                                <MediaElement
                                    x:Name="MediaElement"
                                    Grid.Row="2"
                                    MaxWidth="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=FrameworkElement}}"
                                    MaxHeight="{c:Binding 'ActualHeight - 75',
                                                          RelativeSource={RelativeSource AncestorType=FrameworkElement}}"
                                    LoadedBehavior="Manual"
                                    PreviewMouseDown="MediaElement_PreviewMouseDown"
                                    Source="{Binding ActiveVideo}" />
                                <Label
                                    Grid.Row="3"
                                    Width="{Binding ActualWidth, ElementName=MediaElement}"
                                    Padding="0,5,1,0"
                                    HorizontalContentAlignment="Right"
                                    Content="{Binding ActiveVideoTimeString}" />
                                <Slider
                                    x:Name="MediaScrub"
                                    Grid.Row="4"
                                    Width="{Binding ActualWidth, ElementName=MediaElement}"
                                    IsMoveToPointEnabled="True"
                                    Maximum="1"
                                    Minimum="0" />
                            </Grid>
                        </Expander>

                        <Expander
                            Grid.Column="0"
                            Padding="0,10,0,0"
                            Background="{DynamicResource SystemControlBackgroundListLowBrush}"
                            ExpandDirection="Right"
                            IsExpanded="{Binding IsMainControlExpanded}">
                            <TabControl
                                Margin="0,-15,0,0"
                                Background="#e6e6e6"
                                ItemsSource="{Binding Channels}"
                                SelectedItem="{Binding SelectedChannel}">
                                <TabControl.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Channel.VanityName}" ToolTip="{Binding Channel.ExtendedDescription}" />
                                    </DataTemplate>
                                </TabControl.ItemTemplate>
                                <TabControl.ContentTemplate>
                                    <DataTemplate>
                                        <Grid Background="White">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto" />
                                                <RowDefinition Height="Auto" />
                                                <RowDefinition Height="*" />
                                            </Grid.RowDefinitions>

                                            <Grid Margin="15,10,30,10" Visibility="{c:Binding 'QueueMode', FalseToVisibility=Collapsed}" />

                                            <Expander
                                                Grid.Row="0"
                                                Margin="15,15,30,15"
                                                Visibility="{c:Binding '!QueueMode',
                                                                       FalseToVisibility=Collapsed}">
                                                <Expander.Header>
                                                    <!--  Need to use this width hack in order for the header content to stretch horizontally  -->
                                                    <!--  https://stackoverflow.com/a/680512/4206279  -->
                                                    <Grid Width="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type Expander}}, Path=ActualWidth}">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto" />
                                                            <ColumnDefinition Width="*" />
                                                        </Grid.ColumnDefinitions>

                                                        <TextBlock Grid.Column="0" Text="Channel Settings" />
                                                        <Border
                                                            Grid.Column="1"
                                                            Margin="10,8,22,5"
                                                            HorizontalAlignment="Stretch"
                                                            Background="{DynamicResource SystemControlBackgroundListLowBrush}"
                                                            CornerRadius="2" />
                                                    </Grid>
                                                </Expander.Header>

                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="50" />
                                                    </Grid.ColumnDefinitions>

                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="5" />
                                                        <RowDefinition Height="Auto" />
                                                        <RowDefinition Height="5" />
                                                        <RowDefinition Height="Auto" />
                                                    </Grid.RowDefinitions>

                                                    <TextBox
                                                        Grid.Row="1"
                                                        Grid.Column="0"
                                                        HorizontalAlignment="Stretch"
                                                        VerticalAlignment="Center"
                                                        Text="{Binding Channel.Identifier, UpdateSourceTrigger=PropertyChanged, Delay=10}" />
                                                    <TextBox
                                                        Grid.Row="1"
                                                        Grid.Column="1"
                                                        Margin="10,0,0,0"
                                                        HorizontalAlignment="Stretch"
                                                        VerticalAlignment="Center"
                                                        Text="{Binding Channel.ChannelPlaylist}" />
                                                    <TextBox
                                                        Grid.Row="1"
                                                        Grid.Column="2"
                                                        Margin="10,0,0,0"
                                                        HorizontalAlignment="Stretch"
                                                        VerticalAlignment="Center"
                                                        Text="{Binding Channel.VanityName}" />
                                                    <Button
                                                        Grid.Row="1"
                                                        Grid.Column="3"
                                                        HorizontalAlignment="Right"
                                                        Command="{Binding LookupChannelCommand}">
                                                        <ui:FontIcon Glyph="{Binding SearchGlyph}" />
                                                    </Button>
                                                    <Button
                                                        Grid.Row="3"
                                                        Grid.Column="0"
                                                        Grid.ColumnSpan="4"
                                                        HorizontalAlignment="Stretch"
                                                        Command="{Binding DeleteCommand}"
                                                        Content="Delete" />
                                                </Grid>
                                            </Expander>

                                            <ScrollViewer Grid.Row="1" HorizontalScrollBarVisibility="Auto">
                                                <Grid Margin="0,0,30,15">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*" />
                                                    </Grid.ColumnDefinitions>

                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="33" />
                                                        <RowDefinition Height="{Binding AdvancedFiltersHeight}" />
                                                        <RowDefinition Height="{Binding ChannelFiltersHeight}" />
                                                    </Grid.RowDefinitions>

                                                    <!--  First row (base filters)  -->
                                                    <Grid Grid.Row="0">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto" />
                                                            <ColumnDefinition Width="10" />
                                                            <ColumnDefinition Width="Auto" />
                                                            <ColumnDefinition Width="10" />
                                                            <ColumnDefinition Width="Auto" />
                                                            <ColumnDefinition Width="0" />
                                                            <ColumnDefinition Width="Auto" />
                                                            <ColumnDefinition Width="10" />
                                                            <ColumnDefinition Width="Auto" />
                                                            <ColumnDefinition Width="10" />
                                                            <ColumnDefinition Width="Auto" />
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="Auto" />
                                                            <ColumnDefinition Width="10" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>

                                                        <Button
                                                            Grid.Column="0"
                                                            Margin="15,0,0,0"
                                                            Command="{Binding FindVideosCommand}"
                                                            Visibility="{c:Binding ChannelMode,
                                                                                   FalseToVisibility=Collapsed}">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="Auto" />
                                                                    <ColumnDefinition Width="5" />
                                                                    <ColumnDefinition Width="Auto" />
                                                                </Grid.ColumnDefinitions>

                                                                <ui:FontIcon Grid.Column="0" Glyph="&#xEBE7;" />
                                                                <TextBlock Grid.Column="2" Text="{x:Static properties:Resources.Search}" />
                                                            </Grid>
                                                        </Button>

                                                        <Button
                                                            Grid.Column="0"
                                                            Margin="15,0,0,0"
                                                            Command="{Binding LoadQueueCommand}"
                                                            Visibility="{c:Binding QueueMode,
                                                                                   FalseToVisibility=Collapsed}">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="Auto" />
                                                                    <ColumnDefinition Width="5" />
                                                                    <ColumnDefinition Width="Auto" />
                                                                </Grid.ColumnDefinitions>

                                                                <ui:FontIcon Grid.Column="0" Glyph="&#xEBE7;" />
                                                                <TextBlock Grid.Column="2" Text="{x:Static properties:Resources.Load}" />
                                                            </Grid>
                                                        </Button>

                                                        <ComboBox
                                                            Grid.Column="2"
                                                            DisplayMemberPath="Description"
                                                            ItemsSource="{Binding MainControlViewModel.SortModeValues}"
                                                            SelectedIndex="{Binding MainControlViewModel.SelectedSortModeIndex}"
                                                            SelectedItem="{Binding MainControlViewModel.SelectedSortMode}"
                                                            Visibility="{c:Binding ChannelMode,
                                                                                   FalseToVisibility=Collapsed}" />

                                                        <ComboBox
                                                            Grid.Column="4"
                                                            DisplayMemberPath="Description"
                                                            ItemsSource="{Binding MainControlViewModel.ExclusionsModeValues}"
                                                            SelectedIndex="{Binding MainControlViewModel.SelectedExclusionsModeIndex}"
                                                            SelectedItem="{Binding MainControlViewModel.SelectedExclusionsMode}"
                                                            Visibility="{c:Binding ChannelMode,
                                                                                   FalseToVisibility=Collapsed}" />

                                                        <ComboBox
                                                            Grid.Column="6"
                                                            DisplayMemberPath="Description"
                                                            ItemsSource="{Binding MainControlViewModel.ExclusionReasonValues}"
                                                            SelectedIndex="{Binding MainControlViewModel.SelectedExclusionFilterIndex}"
                                                            SelectedItem="{Binding MainControlViewModel.SelectedExclusionFilter}"
                                                            Visibility="{c:Binding 'ChannelMode and MainControlViewModel.ShowExclusions',
                                                                                   FalseToVisibility=Collapsed}" />

                                                        <Button
                                                            Grid.Column="8"
                                                            Command="{Binding ToggleShowAdvancedFiltersCommand}"
                                                            Visibility="{c:Binding ChannelMode,
                                                                                   FalseToVisibility=Collapsed}">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="Auto" />
                                                                    <ColumnDefinition Width="5" />
                                                                    <ColumnDefinition Width="Auto" />
                                                                </Grid.ColumnDefinitions>

                                                                <ui:FontIcon Grid.Column="0" Glyph="&#xE71C;" />
                                                                <TextBlock Grid.Column="2" Text="{x:Static properties:Resources.AdvancedFilters}" />
                                                            </Grid>
                                                        </Button>

                                                        <Button
                                                            Grid.Column="10"
                                                            Command="{Binding ToggleShowChannelFiltersCommand}"
                                                            Visibility="{c:Binding ChannelMode,
                                                                                   FalseToVisibility=Collapsed}">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="Auto" />
                                                                    <ColumnDefinition Width="5" />
                                                                    <ColumnDefinition Width="Auto" />
                                                                </Grid.ColumnDefinitions>

                                                                <ui:FontIcon Grid.Column="0" Glyph="&#xEA37;" />
                                                                <TextBlock Grid.Column="2" Text="{x:Static properties:Resources.ChannelFilters}" />
                                                            </Grid>
                                                        </Button>

                                                        <Button
                                                            Grid.Column="12"
                                                            Margin="15,0,0,0"
                                                            Command="{Binding MoveLeftCommand}"
                                                            Visibility="{c:Binding ChannelMode,
                                                                                   FalseToVisibility=Collapsed}">
                                                            <ui:FontIcon Glyph="&#xE760;" />
                                                        </Button>

                                                        <Button
                                                            Grid.Column="14"
                                                            Command="{Binding MoveRightCommand}"
                                                            Visibility="{c:Binding ChannelMode,
                                                                                   FalseToVisibility=Collapsed}">
                                                            <ui:FontIcon Glyph="&#xE761;" />
                                                        </Button>
                                                    </Grid>

                                                    <!--  Second row (advanced filters)  -->
                                                    <StackPanel
                                                        Grid.Row="1"
                                                        Margin="0,10,0,0"
                                                        VerticalAlignment="Center"
                                                        Orientation="Horizontal">

                                                        <Border Width="15" />

                                                        <TextBlock
                                                            VerticalAlignment="Center"
                                                            FontWeight="SemiBold"
                                                            Text="Advanced filters:" />

                                                        <Border Width="15" />

                                                        <TextBox
                                                            MinWidth="250"
                                                            VerticalContentAlignment="Center"
                                                            ui:ControlHelper.PlaceholderText="{x:Static properties:Resources.SearchByTitle}"
                                                            KeyDown="Search_KeyDown"
                                                            Text="{Binding MainControlViewModel.SearchByTitleTerm, UpdateSourceTrigger=PropertyChanged}" />

                                                        <Border Width="15" />

                                                        <CheckBox Content="{x:Static properties:Resources.MaxResults}" IsChecked="{Binding MainControlViewModel.EnableCountLimit}" />

                                                        <Border Width="15" />

                                                        <TextBox
                                                            VerticalContentAlignment="Center"
                                                            ui:ControlHelper.PlaceholderText="{x:Static properties:Resources.MaxResults}"
                                                            IsEnabled="{Binding MainControlViewModel.EnableCountLimit}"
                                                            Text="{Binding MainControlViewModel.CountLimit, UpdateSourceTrigger=PropertyChanged}" />
                                                    </StackPanel>

                                                    <!--  Second row (channel filters)  -->
                                                    <StackPanel
                                                        Grid.Row="2"
                                                        Margin="0,10,0,10"
                                                        VerticalAlignment="Center"
                                                        Orientation="Horizontal">
                                                        <Border Width="15" />

                                                        <TextBlock
                                                            VerticalAlignment="Center"
                                                            FontWeight="SemiBold"
                                                            Text="Channel filters:" />

                                                        <Border Width="10" />

                                                        <CheckBox Content="{x:Static properties:Resources.DoNotShowVideosBefore}" IsChecked="{Binding MainControlViewModel.SelectedChannel.Channel.EnableDateRangeLimit}" />

                                                        <Border Width="10" />

                                                        <DatePicker
                                                            ui:ControlHelper.PlaceholderText="{x:Static properties:Resources.DateRangeLimit}"
                                                            IsEnabled="{Binding MainControlViewModel.SelectedChannel.Channel.EnableDateRangeLimit}"
                                                            SelectedDate="{Binding MainControlViewModel.SelectedChannel.Channel.DateRangeLimit}" />

                                                        <Border Width="10" />

                                                        <CheckBox Content="{x:Static properties:Resources.DoNotShowVideosShorterThan}" IsChecked="{Binding MainControlViewModel.SelectedChannel.Channel.EnableVideoLengthMinimum}" />

                                                        <Border Width="10" />

                                                        <ui:NumberBox
                                                            ui:ControlHelper.PlaceholderText="{x:Static properties:Resources.VideoLengthMinimum}"
                                                            IsEnabled="{Binding MainControlViewModel.SelectedChannel.Channel.EnableVideoLengthMinimum}"
                                                            Value="{Binding MainControlViewModel.SelectedChannel.Channel.VideoLengthMinimumInSeconds}" />
                                                    </StackPanel>
                                                </Grid>
                                            </ScrollViewer>

                                            <ItemsControl
                                                Grid.Row="2"
                                                ItemsSource="{Binding Videos}"
                                                VirtualizingPanel.ScrollUnit="Pixel">
                                                <!--
                                                    The ItemsPanel and Template come from https://stackoverflow.com/a/2784220/4206279
                                                    Using a VirtualizingStackPanel causes by-item scrolling, hence the need for ScrollUnit="Pixel" property.
                                                    Together, these changes allow fairly smooth scrolling with MUCH faster load times due to virtualization
                                                -->

                                                <!--  The Panel control that holds the items should support virtualization  -->
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate>
                                                        <VirtualizingStackPanel IsVirtualizing="True" VirtualizationMode="Recycling" />
                                                    </ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>

                                                <!--  The template should be a ScrollViewer  -->
                                                <ItemsControl.Template>
                                                    <ControlTemplate TargetType="ItemsControl">
                                                        <Border
                                                            Background="{TemplateBinding Background}"
                                                            BorderBrush="{TemplateBinding BorderBrush}"
                                                            BorderThickness="{TemplateBinding BorderThickness}">
                                                            <views:MyScrollViewer
                                                                Padding="{TemplateBinding Padding}"
                                                                ui:ScrollViewerHelper.AutoHideScrollBars="False"
                                                                CanContentScroll="True"
                                                                Focusable="False">
                                                                <ItemsPresenter />
                                                            </views:MyScrollViewer>
                                                        </Border>
                                                    </ControlTemplate>
                                                </ItemsControl.Template>

                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Grid Margin="15,0,30,0">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="Auto" />
                                                                <ColumnDefinition Width="*" />
                                                                <ColumnDefinition Width="Auto" />
                                                            </Grid.ColumnDefinitions>

                                                            <Grid.RowDefinitions>
                                                                <RowDefinition Height="Auto" />
                                                                <RowDefinition Height="Auto" />
                                                            </Grid.RowDefinitions>

                                                            <Image
                                                                Grid.Column="0"
                                                                Width="150"
                                                                Margin="0,0,10,10"
                                                                HorizontalAlignment="Left"
                                                                VerticalAlignment="Top"
                                                                Source="{Binding Video.ThumbnailUrl}">
                                                                <Image.Clip>
                                                                    <RectangleGeometry
                                                                        RadiusX="8"
                                                                        RadiusY="8"
                                                                        Rect="0,0,150,85" />
                                                                </Image.Clip>
                                                            </Image>

                                                            <Grid
                                                                Grid.Row="0"
                                                                Grid.Column="1"
                                                                Margin="0,0,15,0">
                                                                <Grid.RowDefinitions>
                                                                    <RowDefinition Height="Auto" />
                                                                    <RowDefinition Height="Auto" />
                                                                    <RowDefinition Height="Auto" />
                                                                    <RowDefinition Height="*" />
                                                                    <RowDefinition Height="Auto" />
                                                                </Grid.RowDefinitions>

                                                                <StackPanel Grid.Row="0" Orientation="Horizontal">
                                                                    <TextBlock
                                                                        FontWeight="Medium"
                                                                        Text="{Binding Video.Title}"
                                                                        TextWrapping="Wrap" />
                                                                    <TextBlock
                                                                        Padding="15,0,15,0"
                                                                        Cursor="Hand"
                                                                        FontWeight="Light"
                                                                        MouseDown="TextBlock_MouseDown"
                                                                        Text="{Binding Video.Id}"
                                                                        TextWrapping="Wrap" />
                                                                </StackPanel>
                                                                <TextBlock
                                                                    Grid.Row="1"
                                                                    Text="{Binding Video.TimeString}"
                                                                    TextWrapping="Wrap" />

                                                                <StackPanel Grid.Row="2" Orientation="Horizontal">
                                                                    <TextBlock
                                                                        Padding="0,0,15,0"
                                                                        FontWeight="Medium"
                                                                        Foreground="Firebrick"
                                                                        Text="{Binding ExcludedString}"
                                                                        TextWrapping="Wrap"
                                                                        Visibility="{c:Binding Video.Excluded,
                                                                                               FalseToVisibility=Collapsed}" />
                                                                    <TextBlock
                                                                        Padding="0,0,15,0"
                                                                        FontWeight="Medium"
                                                                        Foreground="Green"
                                                                        Text="{Binding Video.Status}"
                                                                        TextWrapping="Wrap"
                                                                        Visibility="{c:Binding 'Video.Status != null and !Video.Excluded',
                                                                                               FalseToVisibility=Collapsed}" />
                                                                    <TextBlock
                                                                        FontWeight="Medium"
                                                                        Foreground="Black"
                                                                        Text="{x:Static properties:Resources.Playing}"
                                                                        TextWrapping="Wrap"
                                                                        Visibility="{c:Binding Video.IsPlaying,
                                                                                               FalseToVisibility=Collapsed}" />
                                                                </StackPanel>

                                                                <Expander
                                                                    Grid.Row="3"
                                                                    Header="Description"
                                                                    IsExpanded="{Binding IsDescriptionExpanded}">
                                                                    <ScrollViewer MaxHeight="200" VerticalScrollBarVisibility="Auto">
                                                                        <TextBlock
                                                                            Margin="0,0,0,10"
                                                                            utilities:InlineHelper.Inlines="{Binding FormattedDescription}"
                                                                            TextWrapping="Wrap" />
                                                                    </ScrollViewer>
                                                                </Expander>
                                                            </Grid>

                                                            <Grid Grid.Column="2" VerticalAlignment="Top">
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition />
                                                                    <ColumnDefinition Width="5" />
                                                                    <ColumnDefinition />
                                                                </Grid.ColumnDefinitions>

                                                                <Grid.RowDefinitions>
                                                                    <RowDefinition Height="10" />
                                                                    <RowDefinition />
                                                                    <RowDefinition Height="5" />
                                                                    <RowDefinition />
                                                                    <RowDefinition Height="*" />
                                                                </Grid.RowDefinitions>

                                                                <Button
                                                                    Grid.Row="1"
                                                                    Grid.Column="0"
                                                                    Command="{Binding DownloadVideoCommand}"
                                                                    ToolTip="{x:Static properties:Resources.DownloadButtonToolTip}">
                                                                    <ui:FontIcon Glyph="&#xE896;" />
                                                                    <Button.InputBindings>
                                                                        <MouseBinding Command="{Binding DownloadVideoCommandRightClick}" Gesture="RightClick" />
                                                                    </Button.InputBindings>
                                                                </Button>

                                                                <Button
                                                                    Grid.Row="3"
                                                                    Grid.Column="0"
                                                                    Visibility="{c:Binding '!Video.Excluded',
                                                                                           FalseToVisibility=Collapsed}">
                                                                    <ui:FontIcon Glyph="&#xEA39;" />
                                                                    <ui:FlyoutService.Flyout>
                                                                        <ui:Flyout Opened="Flyout_Opened">
                                                                            <ui:Flyout.FlyoutPresenterStyle>
                                                                                <Style TargetType="ui:FlyoutPresenter">
                                                                                    <Setter Property="Padding" Value="0" />
                                                                                </Style>
                                                                            </ui:Flyout.FlyoutPresenterStyle>

                                                                            <Grid>
                                                                                <Grid.RowDefinitions>
                                                                                    <RowDefinition />
                                                                                    <RowDefinition />
                                                                                    <RowDefinition />
                                                                                </Grid.RowDefinitions>

                                                                                <Button
                                                                                    Grid.Row="0"
                                                                                    HorizontalAlignment="Stretch"
                                                                                    HorizontalContentAlignment="Left"
                                                                                    Background="Transparent"
                                                                                    Command="{Binding ExcludeVideoCommand}"
                                                                                    CommandParameter="{Binding RelativeSource={RelativeSource Self}}"
                                                                                    Content="{x:Static properties:Resources.Watched}" />
                                                                                <Button
                                                                                    Grid.Row="1"
                                                                                    HorizontalAlignment="Stretch"
                                                                                    HorizontalContentAlignment="Left"
                                                                                    Background="Transparent"
                                                                                    Command="{Binding ExcludeVideoCommand}"
                                                                                    CommandParameter="{Binding RelativeSource={RelativeSource Self}}"
                                                                                    Content="{x:Static properties:Resources.WontWatch}" />
                                                                                <Button
                                                                                    Grid.Row="2"
                                                                                    HorizontalAlignment="Stretch"
                                                                                    HorizontalContentAlignment="Left"
                                                                                    Background="Transparent"
                                                                                    Command="{Binding ExcludeVideoCommand}"
                                                                                    CommandParameter="{Binding RelativeSource={RelativeSource Self}}"
                                                                                    Content="{x:Static properties:Resources.MightWatch}" />
                                                                            </Grid>
                                                                        </ui:Flyout>
                                                                    </ui:FlyoutService.Flyout>
                                                                </Button>

                                                                <Button
                                                                    Grid.Row="3"
                                                                    Grid.Column="0"
                                                                    Command="{Binding UnexcludeVideoCommand}"
                                                                    Visibility="{c:Binding 'Video.Excluded',
                                                                                           FalseToVisibility=Collapsed}">
                                                                    <ui:FontIcon Glyph="&#xECC8;" />
                                                                </Button>

                                                                <Button
                                                                    Grid.Row="1"
                                                                    Grid.Column="2"
                                                                    Command="{Binding PlayVideoCommand}">
                                                                    <ui:FontIcon Glyph="&#xE768;" />
                                                                </Button>

                                                                <Button
                                                                    Grid.Row="3"
                                                                    Grid.Column="2"
                                                                    Command="{Binding PlayVideoInBrowserCommand}">
                                                                    <ui:FontIcon Glyph="&#xE774;" />
                                                                </Button>
                                                            </Grid>

                                                            <Border
                                                                Grid.Row="1"
                                                                Grid.Column="0"
                                                                Grid.ColumnSpan="3"
                                                                Height="6"
                                                                Margin="0,0,0,10"
                                                                HorizontalAlignment="Stretch"
                                                                Background="{DynamicResource SystemControlBackgroundListLowBrush}"
                                                                CornerRadius="2" />
                                                        </Grid>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </Grid>
                                    </DataTemplate>
                                </TabControl.ContentTemplate>
                            </TabControl>
                        </Expander>
                    </Grid>
                </Grid>
                <controls:NotificationArea
                    x:Name="NotificationArea"
                    MaxItems="3"
                    Position="BottomCenter" />
            </Grid>
        </busyIndicator:BusyMask>
    </Grid>
</UserControl>